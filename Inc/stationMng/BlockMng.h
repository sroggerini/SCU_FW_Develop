// ------------------------------------------------------------------------------------------------------------------------------------------------------------------- //
//
//  File:           BlockMng.h
//  Author:         Vania
//  Date:           06/11/2020
//
// ------------------------------------------------------------------------------------------------------------------------------------------------------------------- //

// ------------------------------------------------------------------------------------------------------------------------------------------------------------------- //
#ifndef _BLOCKMNG_H
#define _BLOCKMNG_H
// ------------------------------------------------------------------------------------------------------------------------------------------------------------------- //

// -------------------------- global include ------------------------------------------------------------------------------------------------------------------------- //
// ------------------------------------------------------------------------------------------------------------------------------------------------------------------- //

// -------------------------- global defines ------------------------------------------------------------------------------------------------------------------------- //
#define BLOCK_ASSIGNMENT_DONE       (uint8_t)(0x80)
#define BLOCK_POLARITY_MASK         (uint8_t)(0x01)

#define BLOCK_UNLOCK                (uint8_t)(0x00)
#define BLOCK_LOCK                  (uint8_t)(0x01)
// ------------------------------------------------------------------------------------------------------------------------------------------------------------------- //

// -------------------------- global typedef ------------------------------------------------------------------------------------------------------------------------- //
typedef enum // possible value of block_state
{
BLOCK_NULL_STATE = 0,   // not valid block_state
BLOCK_IDLE_STATE,       // idle block_state
BLOCK_DRIVE_MOVING,     // move up/down socket block
BLOCK_DRIVE_COOLING,    // cooling block driver before any other operation/movement
BLOCK_DOWN_STATE,       // socket block down
BLOCK_UP_STATE          // socket block up
}block_state_en;

typedef enum
{
BLOCK_SWITCH_NULL = 0,
BLOCK_SWITCH_UP,
BLOCK_SWITCH_DOWN,
BLOCK_UP_REQ,
BLOCK_DOWN_REQ,
BLOCK_MANUAL_REQ,
BLOCK_IM_TRIGGERED,  // current socket motor over the treshold ---> The motor pin has reached its final position.
BLOCK_STATE_TIM_EXPIRED,
DRIVE_COOLING_TIM_EXPIRED
}BlockMngEvent_en;

/* queue info structure */
typedef __packed struct
{
BlockMngEvent_en    BlockMngEvent;
}BlockMngMsg_st;
// ------------------------------------------------------------------------------------------------------------------------------------------------------------------- //

// -------------------------- global constats ------------------------------------------------------------------------------------------------------------------------ //
// ------------------------------------------------------------------------------------------------------------------------------------------------------------------- //

// -------------------------- global references ---------------------------------------------------------------------------------------------------------------------- //
extern uint8_t           block_polarity;
// ------------------------------------------------------------------------------------------------------------------------------------------------------------------- //

// -------------------------- global function prototypes ------------------------------------------------------------------------------------------------------------- //
void            send_to_block           (uint8_t block_event);
block_state_en  block_state_get         (void);
void            block_anom0_update      (void);
void            block_error_reset       (void);
void            block_movement_set      (uint8_t lock);
void            BlockMngTask            (void *pvParameters);

// ------------------------------------------------------------------------------------------------------------------------------------------------------------------- //
#endif
