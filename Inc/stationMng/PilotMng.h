// ------------------------------------------------------------------------------------------------------------------------------------------------------------------- //
//
//  File:           PilotMng.h
//  Author:         Vania
//  Date:           06/11/2020
//
// ------------------------------------------------------------------------------------------------------------------------------------------------------------------- //

// ------------------------------------------------------------------------------------------------------------------------------------------------------------------- //
#ifndef _PILOTMNG_H
#define _PILOTMNG_H
// ------------------------------------------------------------------------------------------------------------------------------------------------------------------- //

// -------------------------- global include ------------------------------------------------------------------------------------------------------------------------- //
// ------------------------------------------------------------------------------------------------------------------------------------------------------------------- //

// -------------------------- global defines ------------------------------------------------------------------------------------------------------------------------- //
#define CP_FILTERED			(uint16_t)(CPLOST_CRL1)
#define CP_INSTANT			(CP_FILTERED << 8)
#define PP_FILTERED			(uint16_t)(PPLOST_CRL1)
#define PP_INSTANT			(PP_FILTERED << 8)
// ------------------------------------------------------------------------------------------------------------------------------------------------------------------- //

// -------------------------- global typedef ------------------------------------------------------------------------------------------------------------------------- //
typedef enum // possible value of rect_presence
{
RECT_NULL,
RECT_PRESENT,
RECT_ABSENT
}rect_state_en;

typedef enum // possible value of CPcharge_state
{
S2_STATE_A,
S2_STATE_B,
S2_STATE_Bx,
S2_STATE_C,
S2_STATE_D
}s2_state_en;

typedef enum // possible value of plug_state
{
PLUG_NULL_STATE,        // not valid evs_state
PLUG_NOT_PRESENT,        // no plug detected
PLUG_DETECTED,
PLUG_INSERTED            // plug completely inserted according to plug_presence
}plug_state_en;

typedef enum
{
PILOT_EVENT_NULL = 0,
PILOT_START,
PILOT_TIMEOUT
}PilotMngEvent_en;

/* queue info structure */
typedef __packed struct
{
PilotMngEvent_en        PilotMngEvent;
}PilotMngMsg_st;
// ------------------------------------------------------------------------------------------------------------------------------------------------------------------- //

// -------------------------- global constats ------------------------------------------------------------------------------------------------------------------------ //
// ------------------------------------------------------------------------------------------------------------------------------------------------------------------- //

// -------------------------- global references ---------------------------------------------------------------------------------------------------------------------- //
// ------------------------------------------------------------------------------------------------------------------------------------------------------------------- //

// -------------------------- global function prototypes ------------------------------------------------------------------------------------------------------------- //
void send_to_pilot(uint8_t pilot_event);
void xp_short_enable_set(uint8_t enable);
void xp_presence_enable_set(uint8_t enable);
uint16_t plug_presence_get(void);
plug_state_en plug_state_get(void);
uint16_t ppcurrent_get(void);
void pilot_lost_set(uint8_t anom1, uint8_t val);
void pilot_anom1_update(void);
void pilot_anom2_update(void);
void pilot_error_reset(void);
void s2_control_set(uint8_t enable);
s2_state_en s2_state_get(void);
void rect_enable_set(uint8_t enable);
void xp_presence_freeze_set(uint8_t val);
void PilotMngTask(void *pvParameters);
// ------------------------------------------------------------------------------------------------------------------------------------------------------------------- //
#endif
